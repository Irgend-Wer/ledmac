

\newwrite\eled@sectionningR@out




\renewcommand*{\do@lineL}{%
  \advance\countLline \@ne
  \ifvbox\namebox{l@dLcolrawbox\the\l@dpscL}%
  {\vbadness=10000
   \splittopskip=\z@
   \do@lineLhook
   \l@demptyd@ta
   \global\setbox\one@line=\vsplit\namebox{l@dLcolrawbox\the\l@dpscL}
                           to\baselineskip}%
  \IfStrEq{\splitfirstmarks\parledgroup@}{begin}{\parledgroup@notes@startL}{}
  \unvbox\one@line \global\setbox\one@line=\lastbox
  \getline@numL
\ifnum\@lock>\@ne\inserthangingsymboltrue\else\inserthangingsymbolfalse\fi
  \setbox\l@dleftbox
  \hb@xt@ \Lcolwidth{%
      \affixpstart@numL
    \affixline@num
    \add@inserts\affixside@note
    \xifinlist{\the\l@dpscL}{\eled@sections@@}%
    {}%
     {\print@lineL}%
  }%
  \add@penaltiesL
  \global\advance\@donereallinesL\@ne
  \global\advance\@donetotallinesL\@ne
\else
  \setbox\l@dleftbox \hb@xt@ \Lcolwidth{\hspace*{\Lcolwidth}}%
  \global\advance\@donetotallinesL\@ne
\fi}




\def\print@ledsectionL{%
    \ifdefstring{\@eledsectnotoc}{L}{\ledsectnotoc}{}
    \numdef{\temp@}{\l@dpscL-1}%
    \xifinlist{\temp@}{\eled@sections@@}{\@nobreaktrue}{\@nobreakfalse}%
    \csuse{eled@sectionning@\the\l@dpscL}%
    \hspace{\paperwidth}{\new@line \l@dunhbox@line{\one@line}}%
    \vskip\eledsection@correcting@skip%
}



\def\print@lineL{%
    \l@dld@ta%
    \l@dlsn@te%
    {\ledllfill\hb@xt@ \wd\one@line{\do@insidelineLhook\inserthangingsymbolL\new@lineL\l@dunhbox@line{\one@line}}\correcthangingL\ledrlfill\l@drd@ta%
     \l@drsn@te}}
  
  



\renewcommand*{\do@lineR}{%
  \advance\countRline \@ne
  \ifvbox\namebox{l@dRcolrawbox\the\l@dpscR}%
  {\vbadness=10000
   \splittopskip=\z@
   \do@lineRhook
   \l@demptyd@ta
   \global\setbox\one@lineR=\vsplit\namebox{l@dRcolrawbox\the\l@dpscR}
                           to\baselineskip}%
    \IfStrEq{\splitfirstmarks\parledgroup@}{begin}{\parledgroup@notes@startR}{}
  \unvbox\one@lineR \global\setbox\one@lineR=\lastbox
  \getline@numR
\ifnum\@lockR>\@ne\inserthangingsymbolRtrue\else\inserthangingsymbolRfalse\fi
  \setbox\l@drightbox
  \hb@xt@ \Rcolwidth{%
      \affixpstart@numR
    \affixline@numR
        \add@insertsR
    \affixside@noteR
        \xifinlist{\the\l@dpscR}{\eled@sectionsR@@}
     {}%
     {\print@lineR}%
    }%
  \add@penaltiesR
  \global\advance\@donereallinesR\@ne
  \global\advance\@donetotallinesR\@ne
\else
  \setbox\l@drightbox \hb@xt@ \Rcolwidth{\hspace*{\Rcolwidth}}
  \global\advance\@donetotallinesR\@ne
\fi}

\def\print@lineR{%
    \l@dld@ta%
    \l@dlsn@te%
\correcthangingR\ledllfill\hb@xt@ \wd\one@lineR{\do@insidelineRhook\inserthangingsymbolR\new@lineR\l@dunhbox@line{\one@lineR}}\ledrlfill\l@drd@ta%
     \l@drsn@te
  }

\def\print@ledsectionR{%
    \initnumbering@sectcountR%
    \ifdefstring{\@eledsectnotoc}{R}{\ledsectnotoc}{}
    \numdef{\temp@}{\l@dpscR-1}%
    \xifinlist{\temp@}{\eled@sectionsR@@}{\@nobreaktrue}{\@nobreakfalse}%
    \csuse{eled@sectionning@\the\l@dpscR}%
    \hspace{\paperwidth}{\new@lineR \l@dunhbox@line{\one@lineR}}%
    \vskip\eledsection@correcting@skip
}
\newsavebox{\@ledsectionL}
\newsavebox{\@ledsectionR}
\renewcommand*{\Columns}{%
  \eledsection@correcting@skip=-\eledsection@correcting@skip
  \setcounter{pstartL}{\value{pstartLold}}
  \setcounter{pstartR}{\value{pstartRold}}
  \ifnum\l@dnumpstartsL=\l@dnumpstartsR\else
    \led@err@BadLeftRightPstarts{\the\l@dnumpstartsL}{\the\l@dnumpstartsR}%
  \fi
  \begingroup
    \l@dzeropenalties
    \endgraf\global\num@lines=\prevgraf
            \global\num@linesR=\prevgraf
    \global\par@line=\z@
    \global\par@lineR=\z@
    \global\l@dpscL=\z@
    \global\l@dpscR=\z@
    \check@pstarts
    \loop\if@pstarts
        \global\pstartnumtrue
        \global\pstartnumRtrue
      \global\advance\l@dpscL \@ne
      \global\advance\l@dpscR \@ne
      \checkraw@text
      \l@dchecklang
{        \loop\ifaraw@text
          \ifl@dsamelang
            \do@lineL
            \do@lineR
          \else
            \l@duselanguage{\theledlanguageL}%
            \do@lineL
            \xifinlist{\the\l@dpscL}{\eled@sections@@}
                {\savebox{\@ledsectionL}{\parbox{\Rcolwidth}{\print@ledsectionL}}}%
                {}%
            \l@duselanguage{\theledlanguageR}%
            \do@lineR
            \xifinlist{\the\l@dpscR}{\eled@sectionsR@@}
                {\savebox{\@ledsectionR}{\parbox{\Lcolwidth}{\print@ledsectionR}}}%
                {}%
          \fi
          \hb@xt@ \hsize{%
           \hfill \unhbox\l@dleftbox\usebox{\@ledsectionL}
            \hfill \columnseparator  \hfill
            \unhbox\l@drightbox\usebox{\@ledsectionR}
          }%
          \checkraw@text
          \checkverseL
          \checkverseR
          \checkpb@columns
        \repeat}
      \@writelinesinparL
      \@writelinesinparR
      \check@pstarts
            \ifbypstart@
           \write\linenum@out{\string\@set[1]}
           \resetprevline@
        \fi
       \ifbypstart@R
           \write\linenum@outR{\string\@set[1]}
           \resetprevline@
        \fi
      \addtocounter{pstartL}{1}
      \addtocounter{pstartR}{1}
    \repeat
    \flush@notes
    \flush@notesR
  \endgroup
  \global\l@dpscL=\z@
  \global\l@dpscR=\z@
  \global\l@dnumpstartsL=\z@
  \global\l@dnumpstartsR=\z@
  \ignorespaces
    \global\instanzaLfalse
    \global\instanzaRfalse}


\renewcommand*{\Pages}{%
  \eledsection@correcting@skip=-2\baselineskip
  \setcounter{pstartL}{\value{pstartLold}}
  \setcounter{pstartR}{\value{pstartRold}}
  \parledgroup@notespacing@set@correction
  \typeout{}
  \typeout{*************************** PAGES ***************************}
  \ifnum\l@dnumpstartsL=\l@dnumpstartsR\else
    \led@err@BadLeftRightPstarts{\the\l@dnumpstartsL}{\the\l@dnumpstartsR}%
  \fi
  \cleartol@devenpage
  \begingroup
    \l@dzeropenalties
    \endgraf\global\num@lines=\prevgraf
            \global\num@linesR=\prevgraf
    \global\par@line=\z@
    \global\par@lineR=\z@
    \global\l@dpscL=\z@
    \global\l@dpscR=\z@
    \writtenlinesLfalse
    \writtenlinesRfalse
    \check@pstarts
    \loop\if@pstarts
      \global\advance\l@dpscL \@ne
      \global\advance\l@dpscR \@ne
      \getlinesfromparlistL
      \getlinesfromparlistR
      \l@dcalc@maxoftwo{\@cs@linesinparL}{\@cs@linesinparR}%
          {\usenamecount{l@dmaxlinesinpar\the\l@dpscL}}%
      \check@pstarts
    \repeat
    \global\l@dpscL=\z@
    \global\l@dpscR=\z@
    \getlinesfrompagelistL
    \getlinesfrompagelistR
    \l@dcalc@minoftwo{\@cs@linesonpageL}{\@cs@linesonpageR}%
        {\l@dminpagelines}%
    \check@pstarts
    \if@pstarts
      \global\advance\l@dpscL \@ne
      \global\advance\l@dpscR \@ne
      \global\@donereallinesL=\z@
      \global\@donetotallinesL=\z@
      \global\@donereallinesR=\z@
      \global\@donetotallinesR=\z@
      \checkraw@text
{        \loop\ifaraw@text
          \checkpageL
          \l@duselanguage{\theledlanguageL}%
%%%          \begingroup
{            \loop\ifl@dsamepage
              \do@lineL
              \xifinlist{\the\l@dpscL}{\eled@sections@@}
                {\print@ledsectionL}%
                {}%
              \advance\numpagelinesL \@ne
              \ifshiftedpstarts
                      \ifdim\ht\l@dleftbox>0pt\hb@xt@ \hsize{\ledstrutL\unhbox\l@dleftbox}\fi%
              \else%
                      \parledgroup@correction@notespacing{L}
                      \hb@xt@ \hsize{\ledstrutL\unhbox\l@dleftbox}%
              \fi
              \get@nextboxL
              \checkpageL
              \checkverseL
              \checkpbL
            \repeat
            \ifl@dpagefull
              \@writelinesonpageL{\the\numpagelinesL}%
            \else
              \@writelinesonpageL{1000}%
            \fi
            \numpagelinesL \z@
            \parledgroup@correction@notespacing@init
            \clearl@dleftpage }%
          \checkpageR
          \l@duselanguage{\theledlanguageR}%
{            \loop\ifl@dsamepage
              \do@lineR
              \xifinlist{\the\l@dpscR}{\eled@sectionsR@@}
                {\print@ledsectionR}%
                {}%
              \advance\numpagelinesR \@ne
              \ifshiftedpstarts
                      \ifdim\ht\l@drightbox>0pt\hb@xt@ \hsize{\ledstrutR\unhbox\l@drightbox}\fi%
              \else%
                      \parledgroup@correction@notespacing{R}
                      \hb@xt@ \hsize{\ledstrutR\unhbox\l@drightbox}%
              \fi
              \get@nextboxR
              \checkpageR
              \checkverseR
              \checkpbR
            \repeat
            \ifl@dpagefull
              \@writelinesonpageR{\the\numpagelinesR}%
            \else
              \@writelinesonpageR{1000}%
            \fi
            \numpagelinesR=\z@
            \parledgroup@correction@notespacing@init
            \clearl@drightpage}
          \checkraw@text
          \ifaraw@text
            \getlinesfrompagelistL
            \getlinesfrompagelistR
            \l@dcalc@minoftwo{\@cs@linesonpageL}{\@cs@linesonpageR}%
                             {\l@dminpagelines}%
          \fi
        \repeat}
    \fi
    \flush@notes
    \flush@notesR
  \endgroup
  \global\l@dpscL=\z@
  \global\l@dpscR=\z@
  \global\l@dnumpstartsL=\z@
  \global\l@dnumpstartsR=\z@
    \global\instanzaLfalse
    \global\instanzaRfalse
  \ignorespaces}
