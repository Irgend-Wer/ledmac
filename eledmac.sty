\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{eledmac}[2012/09/16 v1.0.1 LaTeX port of EDMAC]


\RequirePackage{xargs}
\RequirePackage{etoolbox}




\newinsert\Afootins
\dimen\Afootins=0.8\vsize
\count\Afootins=1000


\newcommand*{\Afootstart}[1]{%
  \rightskip=0pt \leftskip=0pt \parindent=0pt
}
\newcommand*{\footsplitskips}{%
  \interlinepenalty=\interfootnotelinepenalty
  \floatingpenalty=\@MM
  \splittopskip=\ht\strutbox \splitmaxdepth=\dp\strutbox
  \leftskip=\z@skip \rightskip=\z@skip}
\newcommand*{\Avfootnote}[2]{%
  \insert\Afootins
  \bgroup
    \footsplitskips
    \setbox0=\vbox{\hsize=\maxdimen
      \Afootfmt{#2}}%
    \setbox0=\hbox{\unvxh0}%
    \dp0=0pt
    \box0
    \penalty0
  \egroup}


\newcommandx*{\unvxh}[1]{
  \setbox0=\vbox{\unvbox#1%
    \global\setbox1=\lastbox}%
  \unhbox1
  }

\newcommandx*{\Afootfmt}[1]{%
  #1}
\newcommand*{\Afootgroup}[1]{%
  \unvbox\Afootins\removehboxes
  \setbox0=\hbox{\unhbox0 \removehboxes}%
  \noindent\unhbox0\par}



\newcommand*{\removehboxes}{\setbox0=\lastbox
  \ifhbox0{\removehboxes}\unhbox0 \fi}


\newinsert\Afootins

\newcommand{\Afootnote}[1]{%
             \Avfootnote{A}%
             {#1}
     \ignorespaces%
     }


\providecommand{\m@m@makecoltext}{%
    \setbox\@outputbox \vbox to\@colht {%
      \@texttop
      \dimen@ \dp\@outputbox
      \unvbox\@outputbox
      \vskip -\dimen@
      \@textbottom}%
  }


\gdef\l@d@makecol{%
  \l@ddofootinsert
  \m@m@makecoltext
  \global \maxdepth \@maxdepth}

\newcommand*{\l@ddofootinsert}{%
   \ifvoid\footins
     \setbox\@outputbox \box\@cclv
   \else
     \setbox\@outputbox \vbox {%
       \boxmaxdepth \@maxdepth
       \@tempdima\dp\@cclv
       \unvbox \@cclv
       \vskip \skip\footins
       \color@begingroup
         \normalcolor
         \footnoterule
         \unvbox \footins
       \color@endgroup
       }%
   \fi
   \l@ddoxtrafeet
}

\newcommand*{\l@ddoxtrafeet}{%
  \doxtrafeetii}

\newcommand*{\doxtrafeetii}{%
  \setbox\@outputbox \vbox{%
    \unvbox\@outputbox
    \@opxtrafeetii}}
\newcommand*{\@opxtrafeetii}{%
 \ifvoid\Afootins\else\Afootstart{A}\Afootgroup{##1}\fi
}

\gdef\@makecol{\l@d@makecol}%



\endinput
%%
%% End of file `eledmac.sty'.
